<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Thanh Chọn Màu Đầy Đủ</title>
  <style>
    body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; margin-top: 40px;}
    #color-bar-wrapper { position: relative; width: 600px; height: 72px; margin-top: 30px;}
    #color-bar { width: 100%; height: 72px; border-radius: 18px; cursor: pointer; box-shadow: 0 0 12px #aaa;}
    #marker { position: absolute; width: 18px; height: 72px; border: 2px solid #fff; border-radius: 8px; pointer-events: none; box-shadow: 0 0 8px #0008; top: 0;}
    #color-info {
      margin-top: 22px; font-size: 1.2em;
      display: flex; flex-direction: column; align-items: flex-start;
      min-width: 340px;
      background: #f8f8f8;
      padding: 16px 24px;
      border-radius: 16px;
      box-shadow: 0 0 16px #eee;
      position: relative;
    }
    #copy-btn { margin-left: 0; margin-top: 8px; padding: 6px 16px; font-size: 1em; cursor: pointer; }
    #color-name {
      margin-left: 0;
      margin-top: 8px;
      font-weight: bold;
      font-size: 1.15em;
      min-width: 150px;
    }
    #sample-color {
      width: 200px;
      height: 80px;
      border-radius: 14px;
      border: 2px solid #888;
      margin-left: 0;
      margin-top: 12px;
      box-shadow: 0 0 18px #aaa;
      background: #fff;
      display: inline-block;
      vertical-align: middle;
    }
    #rgb-value {
      margin-left: 0;
      margin-top: 8px;
      font-size: 1.08em;
      color: #444;
      min-width: 120px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      line-height: 1.6;
    }
    .rgb-label {
      font-weight: bold;
      margin-right: 4px;
    }
    .rgb-r { color: #d00; }
    .rgb-g { color: #090; }
    .rgb-b { color: #06c; }
    .rgb-percent {
      color: #666;
      font-size: 0.98em;
      margin-left: 2px;
      font-weight: normal;
    }
    .desc-note {
      margin-top: 18px;
      color: #555;
      font-size: 1em;
      background: #eef2f7;
      border-radius: 8px;
      padding: 12px 16px;
      line-height: 1.7;
      max-width: 420px;
    }
    .footer-link {
      margin-top: 60px;
      font-size: 1.15em;
    }
    .created-by {
      margin-top: 10px;
      margin-bottom: 18px;
      color: #666;
      font-size: 1em;
    }
  </style>
</head>
<body>
  <h2>Thanh Chọn Màu Đầy Đủ</h2>
  <div>Kéo thanh để chọn màu, đầy đủ sắc thái</div>
  <div id="color-bar-wrapper">
    <canvas id="color-bar" width="600" height="72"></canvas>
    <div id="marker" style="display:none"></div>
  </div>
  <div id="color-info">
    <div>Mã màu: <span id="color-code">#FF0000</span></div>
    <button id="copy-btn">Copy</button>
    <div id="color-name">Màu đỏ</div>
    <div id="rgb-value">
      <div><span class="rgb-label rgb-r">R:</span>255 <span class="rgb-percent">(100%)</span></div>
      <div><span class="rgb-label rgb-g">G:</span>0 <span class="rgb-percent">(0%)</span></div>
      <div><span class="rgb-label rgb-b">B:</span>0 <span class="rgb-percent">(0%)</span></div>
    </div>
    <div id="sample-color" style="background:#FF0000"></div>
    <div class="desc-note">
      <b>Chú thích:</b><br>
      - Thông số <b>R, G, B</b> là giá trị màu Đỏ, Xanh Lá, Xanh Dương theo hệ màu RGB, nằm trong khoảng từ <b>0</b> đến <b>255</b>.<br>
      - Phần trăm (%) bên cạnh là tỉ lệ mỗi kênh màu so với giá trị tối đa (255), giúp bạn ước lượng khi pha chế hoặc phối màu.<br>
      - Ví dụ: <b>R:128 (50%)</b> nghĩa là thành phần màu đỏ chiếm 50% cường độ tối đa.<br>
    </div>
  </div>
  <div class="footer-link">
    <a href="https://nhut990.github.io/">Quay về trang chủ</a>
  </div>
  <div class="created-by">
    Created by Minh Nhựt
  </div>
  <script>
    // Hàm chuyển HSL sang RGB (ES5, không dùng cú pháp mới)
    function hslToRgb(h, s, l) {
      var r, g, b;
      h = h / 360;
      if (s === 0) {
        r = g = b = l;
      } else {
        var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
        var p = 2 * l - q;
        r = hue2rgb(p, q, h + 1 / 3);
        g = hue2rgb(p, q, h);
        b = hue2rgb(p, q, h - 1 / 3);
      }
      return [
        Math.round(r * 255),
        Math.round(g * 255),
        Math.round(b * 255)
      ];
    }
    function hue2rgb(p, q, t) {
      if (t < 0) t += 1;
      if (t > 1) t -= 1;
      if (t < 1 / 6) return p + (q - p) * 6 * t;
      if (t < 1 / 2) return q;
      if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;
      return p;
    }
    // Hàm chuyển RGB sang HEX
    function rgbToHex(r, g, b) {
      return "#" +
        ("0" + r.toString(16)).slice(-2).toUpperCase() +
        ("0" + g.toString(16)).slice(-2).toUpperCase() +
        ("0" + b.toString(16)).slice(-2).toUpperCase();
    }

    // Vẽ thanh màu thủ công, từng pixel, đảm bảo tương thích máy cũ
    var canvas = document.getElementById('color-bar');
    var ctx = canvas.getContext('2d');
    var width = canvas.width;
    var height = canvas.height;

    function drawColorBar() {
      var imgData = ctx.createImageData(width, height);
      for (var x = 0; x < width; x++) {
        var h = x / width * 360;
        var s = 1.0;
        var l = 0.5;
        var rgb = hslToRgb(h, s, l);
        for (var y = 0; y < height; y++) {
          var idx = (y * width + x) * 4;
          imgData.data[idx] = rgb[0];
          imgData.data[idx + 1] = rgb[1];
          imgData.data[idx + 2] = rgb[2];
          imgData.data[idx + 3] = 255;
        }
      }
      ctx.putImageData(imgData, 0, 0);
    }
    drawColorBar();

    // Lấy màu tại vị trí x
    function getColorAtPosition(x) {
      var h = Math.max(0, Math.min(360, Math.round(x / width * 360)));
      var s = 1.0, l = 0.5;
      var rgbArr = hslToRgb(h, s, l);
      var hex = rgbToHex(rgbArr[0], rgbArr[1], rgbArr[2]);
      return {
        hex: hex,
        h: h,
        s: s,
        l: l,
        rgb: { r: rgbArr[0], g: rgbArr[1], b: rgbArr[2] }
      };
    }

    // Nhận diện tên màu tiếng Việt hợp lý nhất theo Hue HSL
    function getVietnameseColorName(h, s, l) {
      if (l >= 0.95) return "Màu trắng";
      if (l <= 0.10) return "Màu đen";
      if (s <= 0.12 && l > 0.10 && l < 0.88) return "Màu xám";
      if (l >= 0.88 && h >= 40 && h <= 70) return "Màu kem";
      if ((h >= 20 && h < 45) && l < 0.54 && s > 0.25) return "Màu nâu";
      if ((h >= 45 && h < 55) && l < 0.54 && s > 0.23) return "Màu vàng nâu";
      if ((h >= 18 && h < 45) && l >= 0.54 && l < 0.80 && s < 0.32) return "Màu be";
      if ((h >= 0 && h < 13) || (h >= 347 && h <= 360)) return "Màu đỏ";
      if (h >= 13 && h < 30) return "Màu cam đỏ";
      if (h >= 30 && h < 45) return "Màu cam";
      if (h >= 45 && h < 54) return "Vàng cam";
      if (h >= 54 && h <= 66) return "Màu vàng";
      if (h > 66 && h <= 80) return "Vàng chanh";
      if (h > 80 && h <= 140) return "Xanh lá cây";
      if (h > 140 && h <= 166) return "Xanh lục";
      if (h > 166 && h <= 185) return "Xanh ngọc";
      if (h > 185 && h <= 195) return "Xanh cyan";
      if (h > 195 && h <= 210) return "Xanh nước biển";
      if (h > 210 && h <= 225) return "Xanh da trời";
      if (h > 225 && h <= 245) return "Xanh lam";
      if (h > 245 && h <= 260) return "Xanh navy";
      if (h > 260 && h <= 280) return "Màu tím";
      if (h > 280 && h <= 295) return "Tím hồng";
      if (h > 295 && h <= 320) return "Màu hồng";
      if (h > 320 && h < 347) return "Đỏ hồng";
      return "Màu không xác định";
    }

    function percent(val) {
      return Math.round(val / 255 * 100);
    }

    // DOM tham chiếu
    var marker = document.getElementById('marker');
    var colorCodeSpan = document.getElementById('color-code');
    var copyBtn = document.getElementById('copy-btn');
    var sampleColorDiv = document.getElementById('sample-color');
    var colorNameDiv = document.getElementById('color-name');
    var rgbValueDiv = document.getElementById('rgb-value');

    function showColorAt(x) {
      var colorData = getColorAtPosition(x);
      colorCodeSpan.textContent = colorData.hex;
      marker.style.display = "block";
      // Đảm bảo marker không bị tràn biên
      var markerLeft = Math.max(0, Math.min(x - 9, width - 18));
      marker.style.left = markerLeft + "px";
      marker.style.background = colorData.hex;
      sampleColorDiv.style.background = colorData.hex;
      colorNameDiv.textContent = getVietnameseColorName(colorData.h, colorData.s, colorData.l);
      rgbValueDiv.innerHTML =
        '<div><span class="rgb-label rgb-r">R:</span>' + colorData.rgb.r + ' <span class="rgb-percent">(' + percent(colorData.rgb.r) + '%)</span></div>' +
        '<div><span class="rgb-label rgb-g">G:</span>' + colorData.rgb.g + ' <span class="rgb-percent">(' + percent(colorData.rgb.g) + '%)</span></div>' +
        '<div><span class="rgb-label rgb-b">B:</span>' + colorData.rgb.b + ' <span class="rgb-percent">(' + percent(colorData.rgb.b) + '%)</span></div>';
    }

    function getXFromEvent(e) {
      var rect = canvas.getBoundingClientRect();
      // Touch
      if (e.touches && e.touches.length) {
        return Math.max(0, Math.min(width - 1, e.touches[0].clientX - rect.left));
      }
      // Mouse
      if (typeof e.offsetX !== "undefined") {
        return Math.max(0, Math.min(width - 1, e.offsetX));
      }
      if (typeof e.clientX !== "undefined") {
        return Math.max(0, Math.min(width - 1, e.clientX - rect.left));
      }
      return 0;
    }

    var isDragging = false;

    function handlePointerDown(e) {
      isDragging = true;
      handlePointerMove(e);
      document.addEventListener('mousemove', handlePointerMove);
      document.addEventListener('mouseup', handlePointerUp);
      document.addEventListener('touchmove', handlePointerMove, false);
      document.addEventListener('touchend', handlePointerUp);
    }
    function handlePointerMove(e) {
      if (!isDragging && !(e.type == "mousemove" || e.type == "touchmove")) return;
      var x = getXFromEvent(e);
      showColorAt(x);
      if (e.type === "touchmove" && e.preventDefault) e.preventDefault();
    }
    function handlePointerUp() {
      isDragging = false;
      document.removeEventListener('mousemove', handlePointerMove);
      document.removeEventListener('mouseup', handlePointerUp);
      document.removeEventListener('touchmove', handlePointerMove, false);
      document.removeEventListener('touchend', handlePointerUp);
    }

    canvas.addEventListener('mousedown', handlePointerDown, false);
    canvas.addEventListener('touchstart', handlePointerDown, false);
    canvas.addEventListener('click', function (e) {
      showColorAt(getXFromEvent(e));
      marker.style.display = "block";
    }, false);

    // Hiển thị màu mặc định ban đầu
    showColorAt(0);

    // Copy mã màu, hỗ trợ cả trình duyệt cũ
    copyBtn.onclick = function () {
      var color = colorCodeSpan.textContent;
      if (window.navigator && window.navigator.clipboard && window.navigator.clipboard.writeText) {
        window.navigator.clipboard.writeText(color);
      } else {
        // Fallback cho trình duyệt cũ
        var input = document.createElement('input');
        input.value = color;
        document.body.appendChild(input);
        input.select();
        try {
          document.execCommand('copy');
        } catch (err) { }
        document.body.removeChild(input);
      }
      copyBtn.textContent = "Đã copy " + color;
      setTimeout(function () { copyBtn.textContent = "Copy"; }, 1200);
    };
  </script>
</body>
</html>